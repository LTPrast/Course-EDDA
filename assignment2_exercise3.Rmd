---
title: "Assignment 1"
author: 'Group 67: Jamie Faber, Laurens Prast, Amal Salman'
date: "27 February 2022"
output:
  html_document:
    df_print: paged
  pdf_document: default
highlight: tango
---
```{r include = FALSE}
options(digits=3)
options(knitr.duplicate.label = "allow")
```

## Imports
```{r}
library(ggplot2)
library(car)
```

## Exercise 3
### a) 
```{r}
fruitflies=read.table(file="fruitflies.txt",header=TRUE)
# add loglongevity column
fruitflies$loglongevity <- log(fruitflies$longevity)
fruitflies
```

**Informative plot of the data:**
```{r}
ggplot(fruitflies) +
  geom_point(aes(x=thorax, y=loglongevity, color=activity)) 

ggplot(fruitflies) +
  geom_boxplot(aes(x = thorax, y=loglongevity, fill = activity)) 

# stripchart?
```
**One-way Anova:**
```{r}
aov=lm(loglongevity~activity,data=fruitflies)
anova(aov)
```
p-value < 0.05 so there is significant differences between the activity groups, i.e., sexual activity influences longevity.

Checking assumptions:
```{r}
par(mfrow=c(1,2))
qqnorm(residuals(aov)); qqline(residuals(aov))
plot(fitted(aov),residuals(aov), main = "Residual Plot")
```

```{r}
leveneTest(loglongevity~activity,data=fruitflies)
shapiro.test(residuals(aov))
```

From the plots and tests, the assumption of equal variances is met, but we cannot assume normality, therefore the requirements for the one-way Anova test aren't met.

Therefore, need to use Kruskal-Wallis test instead.

**Kruskal-Wallis:**
```{r}
kruskal.test(loglongevity~activity,data=fruitflies)
```
However, Kruskal-Wallis test comes at the same conclusion as the one-way Anova test:
p-value < 0.05 so there is significant differences between the activity groups, i.e., sexual activity influences longevity.

**Estimated longevities for the three conditions:**
```{r}
summary(aov)
```
The high activity group has an estimated 3.60 longevity, while the isolated activity group has 0.52, and the low activity group has 0.40. This indicates that the higher the activity, the longer the longevity is.

### b)

**ANCOVA test:**

```{r}
fruitflies$activity=as.factor(fruitflies$activity)
fruitflies1=lm(loglongevity~thorax+activity,data=fruitflies)
fruitflies2=lm(loglongevity~thorax,data=fruitflies)
anova(fruitflies2,fruitflies1)
```
p-value < 0.05 so again activity has a significant influence on longevity (now considering thorax but not the interaction between thorax and activity).

```{r}
qqnorm(residuals(fruitflies1))
plot(fitted(fruitflies1),residuals(fruitflies1))
```
ANCOVA however assumes normality, and we have shown in part (a) that we cannot assume normality.

```{r}
summary(fruitflies1)
```
Does sexual activity increase or decrease longevity?
The estimates for all three types of activity are >0 so activity increases longevity. 

```{r}
mid <- median(fruitflies$thorax)
fruitflies_min <- fruitflies[fruitflies$thorax < mid, ]
fruitflies_max <- fruitflies[fruitflies$thorax >= mid, ]

summary(lm(loglongevity~thorax+activity,data=fruitflies_min))
summary(lm(loglongevity~thorax+activity,data=fruitflies_max))
```
What are the estimated longevities for the three groups, for flies with the minimal and maximal thorax lengths?
For flies with minimal thorax: 
high: 0.4755, isolated: 0.4835, low: 0.2941 
For flies with maximal thorax: 
high: 3.0524, isolated: 0.3981, low: 0.2772

### c)

```{r}
colors <- c("#00AFBB", "#E7B800", "#FC4E07")
colors <- colors[as.numeric(fruitflies$activity)]

plot(loglongevity~thorax, col=colors, pch=16, data=fruitflies)
legend("topleft", legend = levels(fruitflies$activity),
      col = c("#00AFBB", "#E7B800", "#FC4E07"), pch = 16, title="activity")
```
```{r}
fruitflies1=lm(loglongevity~activity+thorax,data=fruitflies)
fruitflies2=lm(loglongevity~activity,data=fruitflies)
anova(fruitflies2,fruitflies1)
```

p-value < 0.05 so thorax length influences longevity

```{r}
qqnorm(residuals(fruitflies1))
plot(fitted(fruitflies1),residuals(fruitflies1))
```

```{r}
summary(fruitflies1)
```
thorax =2.9790 > 0 so as thorax length increases, longevity increases, as can also be seen by the plot.

*whether this dependence is similar under all three conditions of sexual activity.*
Yes because all three types of activity have estimates >0?

### d)
Both analyses came to the same conclusion, that activity significantly influences longevity, and the higher the activity the longer the longevity. However, by including thorax length in the analysis, we found out that thorax also significantly influences longevity, and the higher the thorax length, the longer the longevity. So I prefer the analysis with thorax length because it gives a more comprehensive analysis of influences in longevity.

The assumptions for both analyses aren't met?

### e)

```{r}
fruitflies$activity=as.factor(fruitflies$activity)
fruitflies1=lm(longevity~thorax+activity,data=fruitflies)
fruitflies2=lm(longevity~thorax,data=fruitflies)
anova(fruitflies2,fruitflies1)
```
p-value still < 0.05

```{r}
qqnorm(residuals(fruitflies1))
plot(fitted(fruitflies1),residuals(fruitflies1))
```
More normal?

Was it wise to use the logarithm as response?


